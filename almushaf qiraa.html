<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ø±Ø§Ø¯ÙŠÙˆ Ù‚Ø±Ø¢Ù†</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4CAF50;
            --primary-dark: #2E7D32;
            --secondary: #FF9800;
            --bg-gradient: linear-gradient(135deg, #111 0%, #222 100%);
            --card-bg: #222;
            --text: #fff;
            --gold: #FFD700;
            --border-color: #444;
            --ayah-font-size: 1.6em;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
        body.light-mode {
            --bg-gradient: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            --card-bg: #fff;
            --text: #333;
            --border-color: #ddd;
            --primary: #2E7D32;
        }
        body.light-mode .controls, body.light-mode .modal-content { background: rgba(255,255,255,0.98); border: 1px solid #ddd; }
        body.light-mode .top-bar { background: rgba(255,255,255,0.95); }
        body.light-mode select, body.light-mode .go-input { background: #fff; color: #333; border-color: #ccc; }
        body.light-mode .ayah-text { color: #000; }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            margin: 0;
            padding: 220px 10px 90px 10px;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar {
            position: fixed; top: 0; left: 0; width: 100%;
            background: rgba(17, 17, 17, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px;
            z-index: 1000;
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            border-bottom: 1px solid #333;
            min-height: 50px;
        }

        .btn-fab {
            background: #333; color: white; border: none;
            padding: 6px 12px; border-radius: 20px;
            cursor: pointer; font-family: 'Cairo'; font-size: 0.85em;
            display: flex; align-items: center; gap: 5px; transition: 0.2s;
        }
        body.light-mode .btn-fab { background: #eee; color: #333; border: 1px solid #ccc; }
        .btn-fab:hover { transform: scale(1.05); }
        .back-btn { background: var(--primary); color: white; border-radius: 5px; text-decoration: none; padding: 6px 15px; font-weight: bold; display: flex; align-items: center; gap: 5px;}

        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø«Ø§Ø¨Øª */
        .controls {
            position: fixed; top: 55px; left: 0; width: 100%;
            background: rgba(17, 17, 17, 0.98);
            padding: 10px;
            z-index: 950;
            border-bottom: 1px solid #444;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }
        
        select {
            padding: 8px;
            border-radius: 6px;
            background: #333;
            color: white;
            border: 1px solid #555;
            font-family: 'Cairo';
            font-size: 0.9em;
            cursor: pointer;
            max-width: 200px;
            flex: 1 1 150px;
        }

        /* Ø­Ù‚Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¢ÙŠØ© */
        .go-group {
            display: flex;
            gap: 5px;
            flex: 1 1 200px;
        }
        .go-input {
            padding: 8px;
            border-radius: 6px;
            background: #333;
            color: white;
            border: 1px solid #555;
            font-family: 'Cairo';
            font-size: 0.9em;
            width: 100%;
        }
        .go-btn {
            background: var(--info-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0 15px;
            cursor: pointer;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¢ÙŠØ© */
        .ayah-container {
            background: var(--card-bg);
            margin-bottom: 15px;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .ayah-number {
            display: inline-block;
            background: var(--primary);
            color: white;
            width: 35px; height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-left: 10px;
            vertical-align: middle;
            font-family: 'Amiri', serif;
        }
        .ayah-text {
            font-family: 'Amiri', serif;
            font-size: var(--ayah-font-size);
            line-height: 1.8;
            margin: 15px 0;
            text-align: justify;
            cursor: pointer;
            transition: font-size 0.2s;
        }

        /* ØªÙ„ÙˆÙŠÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø³Ø¬ÙˆØ¯ ÙˆØ§Ù„ÙˆÙ‚Ù */
        .sujud-mark {
            color: #ff4d4d; /* Ø£Ø­Ù…Ø± */
            font-size: 1.3em;
            font-weight: bold;
            display: inline-block;
            margin: 0 2px;
            animation: pulse 2s infinite;
        }
        .waqf-mark {
            color: #FF9800; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
            font-size: 1.1em;
            font-weight: bold;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .ayah-actions {
            display: flex; justify-content: flex-end; gap: 10px;
            border-top: 1px solid var(--border-color); padding-top: 10px;
        }
        .btn-action {
            background: transparent; border: 2px solid #555; color: #ccc;
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
            transition: 0.3s; display: flex; align-items: center; justify-content: center;
        }
        .btn-action:hover { background: #444; color: white; }
        .btn-play { border-color: var(--primary); color: var(--primary); }
        .btn-play:hover { background: var(--primary); color: white; }
        .btn-tafsir { border-color: #2196F3; color: #2196F3; }
        .btn-tafsir:hover { background: #2196F3; color: white; }
        .btn-save { border-color: var(--secondary); color: var(--secondary); }
        .btn-save:hover { background: var(--secondary); color: white; }
        .btn-saved { background: var(--secondary); color: white; border-color: var(--secondary); }

        /* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000;
            align-items: center; justify-content: center; padding: 20px;
        }
        .modal-content {
            background: var(--card-bg); padding: 25px; border-radius: 15px;
            max-width: 700px; width: 100%; max-height: 80vh; overflow-y: auto;
            border: 2px solid #2196F3; text-align: right;
        }
        .tafsir-text {
            font-family: 'Amiri', serif; font-size: 1.3em; line-height: 1.8; white-space: pre-wrap;
        }
        .close-modal {
            background: #f44336; color: white; border: none;
            padding: 10px 20px; border-radius: 8px; width: 100%; margin-top: 15px; cursor: pointer;
        }
        
        /* Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª */
        .audio-player-fixed {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #222; padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
            z-index: 1000; display: flex; gap: 10px; align-items: center;
        }
        .audio-player-fixed audio { flex: 1; }
        
        .basmalah { text-align: center; font-family: 'Amiri', serif; font-size: 2em; color: var(--gold); margin: 20px 0; }
        .loading { text-align: center; padding: 50px; font-size: 1.2em; color: #888; }

        /* Toast */
        .toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 10px 20px;
            border-radius: 20px; z-index: 3000; opacity: 0;
            transition: opacity 0.3s; pointer-events: none;
        }
        .toast.show { opacity: 1; }

        @media (max-width: 600px) {
            .top-bar { justify-content: space-between; padding: 8px 5px; }
            .controls { padding: 5px; top: 50px; }
            .go-group { flex: 1 1 100%; }
            select, .go-input { width: 100%; padding: 6px; font-size: 0.8em; }
            body { padding-top: 240px; } /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
            .btn-fab span { display: none; } 
        }
    </style>
</head>
<body>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
<div class="top-bar">
    <a href="https://waleedd189.github.io/radio-quran/" class="back-btn">
        <i class="fas fa-home"></i> <span data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="Home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </a>
    
    <button class="btn-fab" onclick="changeLang()">
        <i class="fas fa-language"></i> <span id="langText">English</span>
    </button>
    <button class="btn-fab" onclick="toggleTheme()">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>
    <button class="btn-fab" onclick="changeFontSize(1)">
        <i class="fas fa-plus"></i>
    </button>
    <button class="btn-fab" onclick="changeFontSize(-1)">
        <i class="fas fa-minus"></i>
    </button>
    <button class="btn-fab" onclick="goToBookmark()" style="background: var(--secondary); color: white;">
        <i class="fas fa-bookmark"></i>
    </button>
</div>

<!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø«Ø§Ø¨Øª -->
<div class="controls">
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± -->
    <select id="surahSelect" onchange="loadSurah()">
        <option value="" disabled selected data-ar="-- Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© --" data-en="-- Select Surah --">-- Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© --</option>
    </select>
    
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡ -->
    <select id="reciterSelect" onchange="loadSurah()">
        <option value="ar.alafasy" data-ar="Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ" data-en="Mishary Rashid">Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</option>
        <option value="ar.husary" data-ar="Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ" data-en="Mahmoud Khalil Al-Husary">Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ</option>
        <option value="ar.minshawi" data-ar="Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ" data-en="Mohammad Siddiq Al-Minshawi">Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ</option>
        <option value="ar.abdulbasitmurattal" data-ar="Ø¹Ø¨Ø¯Ø§Ù„Ø¨Ø§Ø³Ø· (Ù…Ø±ØªÙ„)" data-en="Abdul Basit (Murattal)">Ø¹Ø¨Ø¯Ø§Ù„Ø¨Ø§Ø³Ø· (Ù…Ø±ØªÙ„)</option>
        <option value="ar.sudais" data-ar="Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³" data-en="Abdurrahmaan As-Sudais">Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³</option>
    </select>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙØ³ÙŠØ± -->
    <select id="tafsirSelect" onchange="saveSettings()">
        <option value="ar.muyassar" data-ar="ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±" data-en="Tafsir Al-Muyassar">ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±</option>
        <option value="ar.jalalayn" data-ar="ØªÙØ³ÙŠØ± Ø§Ù„Ø¬Ù„Ø§Ù„ÙŠÙ†" data-en="Tafsir Al-Jalalayn">ØªÙØ³ÙŠØ± Ø§Ù„Ø¬Ù„Ø§Ù„ÙŠÙ†</option>
        <option value="ar.baghawy" data-ar="ØªÙØ³ÙŠØ± Ø§Ù„Ø¨ØºÙˆÙŠ" data-en="Tafsir Al-Baghawi">ØªÙØ³ÙŠØ± Ø§Ù„Ø¨ØºÙˆÙŠ</option>
    </select>

    <!-- Ø²Ø± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¢ÙŠØ© (Ø§Ù„Ø¬Ø¯ÙŠØ¯) -->
    <div class="go-group">
        <input type="number" id="goInput" class="go-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©" min="1">
        <button class="go-btn" onclick="goToAyah()"><i class="fas fa-arrow-down"></i></button>
    </div>
</div>

<h1 style="text-align:center; font-family:'Amiri'; margin: 10px 0;" data-ar="Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ" data-en="Holy Quran">Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ</h1>

<div id="content">
    <div class="loading" data-ar="Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ù„Ù„Ø¨Ø¯Ø¡..." data-en="Select a Surah to start...">Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ù„Ù„Ø¨Ø¯Ø¡...</div>
</div>

<!-- Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª -->
<div class="audio-player-fixed" id="playerContainer" style="display:none;">
    <div style="color: var(--primary); font-weight: bold; white-space: nowrap;" id="currentAyahLabel">
        <i class="fas fa-play-circle"></i>
    </div>
    <audio id="mainAudio" controls></audio>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ³ÙŠØ± -->
<div class="modal" id="tafsirModal">
    <div class="modal-content">
        <h3 style="color: #2196F3; font-family: 'Cairo';" data-ar="ØªÙØ³ÙŠØ± Ø§Ù„Ø¢ÙŠØ©" data-en="Tafsir of Ayah">ØªÙØ³ÙŠØ± Ø§Ù„Ø¢ÙŠØ©</h3>
        <div id="tafsirTextDisplay" class="tafsir-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <button class="close-modal" onclick="closeTafsir()" data-ar="Ø¥ØºÙ„Ø§Ù‚" data-en="Close">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<script>
    // === Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª ===
    const translations = {
        ar: {
            home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", title: "Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ", selectSurah: "-- Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© --",
            play: "ØªØ´ØºÙŠÙ„", tafsir: "ØªÙØ³ÙŠØ±", save: "Ø­ÙØ¸ Ù…ÙˆØ¶Ø¹", saved: "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¶Ø¹",
            loadingTafsir: "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ±...", close: "Ø¥ØºÙ„Ø§Ù‚"
        },
        en: {
            home: "Home", title: "Holy Quran", selectSurah: "-- Select Surah --",
            play: "Play", tafsir: "Tafsir", save: "Save Position", saved: "Position Saved",
            loadingTafsir: "Loading Tafsir...", close: "Close"
        }
    };
    let currentLang = 'ar';
    let currentFontSize = 1.6;

    const surahNames = [
        "Ø§Ù„ÙØ§ØªØ­Ø©", "Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", "Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©", "Ø§Ù„Ø£Ù†Ø¹Ø§Ù…", "Ø§Ù„Ø£Ø¹Ø±Ø§Ù", "Ø§Ù„Ø£Ù†ÙØ§Ù„", "Ø§Ù„ØªÙˆØ¨Ø©", "ÙŠÙˆÙ†Ø³",
        "Ù‡ÙˆØ¯", "ÙŠÙˆØ³Ù", "Ø§Ù„Ø±Ø¹Ø¯", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ø§Ù„Ø­Ø¬Ø±", "Ø§Ù„Ù†Ø­Ù„", "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡", "Ø§Ù„ÙƒÙ‡Ù", "Ù…Ø±ÙŠÙ…", "Ø·Ù‡",
        "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", "Ø§Ù„Ø­Ø¬", "Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†", "Ø§Ù„Ù†ÙˆØ±", "Ø§Ù„ÙØ±Ù‚Ø§Ù†", "Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡", "Ø§Ù„Ù†Ù…Ù„", "Ø§Ù„Ù‚ØµØµ", "Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª", "Ø§Ù„Ø±ÙˆÙ…",
        "Ù„Ù‚Ù…Ø§Ù†", "Ø§Ù„Ø³Ø¬Ø¯Ø©", "Ø§Ù„Ø£Ø­Ø²Ø§Ø¨", "Ø³Ø¨Ø£", "ÙØ§Ø·Ø±", "ÙŠØ³", "Ø§Ù„ØµØ§ÙØ§Øª", "Øµ", "Ø§Ù„Ø²Ù…Ø±", "ØºØ§ÙØ±",
        "ÙØµÙ„Øª", "Ø§Ù„Ø´ÙˆØ±Ù‰", "Ø§Ù„Ø²Ø®Ø±Ù", "Ø§Ù„Ø¯Ø®Ø§Ù†", "Ø§Ù„Ø¬Ø§Ø«ÙŠØ©", "Ø§Ù„Ø£Ø­Ù‚Ø§Ù", "Ù…Ø­Ù…Ø¯", "Ø§Ù„ÙØªØ­", "Ø§Ù„Ø­Ø¬Ø±Ø§Øª", "Ù‚",
        "Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª", "Ø§Ù„Ø·ÙˆØ±", "Ø§Ù„Ù†Ø¬Ù…", "Ø§Ù„Ù‚Ù…Ø±", "Ø§Ù„Ø±Ø­Ù…Ù†", "Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©", "Ø§Ù„Ø­Ø¯ÙŠØ¯", "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©", "Ø§Ù„Ø­Ø´Ø±", "Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©",
        "Ø§Ù„ØµÙ", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†", "Ø§Ù„ØªØºØ§Ø¨Ù†", "Ø§Ù„Ø·Ù„Ø§Ù‚", "Ø§Ù„ØªØ­Ø±ÙŠÙ…", "Ø§Ù„Ù…Ù„Ùƒ", "Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø­Ø§Ù‚Ø©", "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬",
        "Ù†ÙˆØ­", "Ø§Ù„Ø¬Ù†", "Ø§Ù„Ù…Ø²Ù…Ù„", "Ø§Ù„Ù…Ø¯Ø«Ø±", "Ø§Ù„Ù‚ÙŠØ§Ù…Ø©", "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", "Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª", "Ø§Ù„Ù†Ø¨Ø£", "Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª", "Ø¹Ø¨Ø³",
        "Ø§Ù„ØªÙƒÙˆÙŠØ±", "Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±", "Ø§Ù„Ù…Ø·ÙÙÙŠÙ†", "Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚", "Ø§Ù„Ø¨Ø±ÙˆØ¬", "Ø§Ù„Ø·Ø§Ø±Ù‚", "Ø§Ù„Ø£Ø¹Ù„Ù‰", "Ø§Ù„ØºØ§Ø´ÙŠØ©", "Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¨Ù„Ø¯",
        "Ø§Ù„Ø´Ù…Ø³", "Ø§Ù„Ù„ÙŠÙ„", "Ø§Ù„Ø¶Ø­Ù‰", "Ø§Ù„Ø´Ø±Ø­", "Ø§Ù„ØªÙŠÙ†", "Ø§Ù„Ø¹Ù„Ù‚", "Ø§Ù„Ù‚Ø¯Ø±", "Ø§Ù„Ø¨ÙŠÙ†Ø©", "Ø§Ù„Ø²Ù„Ø²Ù„Ø©", "Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª",
        "Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©", "Ø§Ù„ØªÙƒØ§Ø«Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù‡Ù…Ø²Ø©", "Ø§Ù„ÙÙŠÙ„", "Ù‚Ø±ÙŠØ´", "Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†", "Ø§Ù„ÙƒÙˆØ«Ø±", "Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†", "Ø§Ù„Ù†ØµØ±",
        "Ø§Ù„Ù…Ø³Ø¯", "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ", "Ø§Ù„ÙÙ„Ù‚", "Ø§Ù„Ù†Ø§Ø³"
    ];

    // === Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ===
    window.onload = () => {
        loadSettings();
        
        const surahSelect = document.getElementById('surahSelect');
        surahNames.forEach((name, i) => {
            const opt = document.createElement('option');
            opt.value = i + 1;
            opt.innerText = `${i + 1}. ${name}`;
            surahSelect.appendChild(opt);
        });

        const savedSurah = localStorage.getItem('lastQuranSurah');
        if(savedSurah) {
            surahSelect.value = savedSurah;
            loadSurah();
        }
    };

    // === ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø© ===
    async function loadSurah() {
        const surahNum = document.getElementById('surahSelect').value;
        if (!surahNum) return;
        localStorage.setItem('lastQuranSurah', surahNum);

        const reciter = document.getElementById('reciterSelect').value;
        const contentDiv = document.getElementById('content');
        contentDiv.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin fa-2x"></i><br><br>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

        try {
            const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahNum}/editions/quran-uthmani,${reciter}`);
            const data = await response.json();
            if (data.code !== 200) throw new Error("API Error");
            renderSurah(data.data[0].ayahs, data.data[1].ayahs, surahNum);
        } catch (error) {
            console.error(error);
            contentDiv.innerHTML = '<div class="loading" style="color:red">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.</div>';
        }
    }

    // === Ø¹Ø±Ø¶ Ø§Ù„Ø¢ÙŠØ§Øª (Ù…Ø¹ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø³Ø¬ÙˆØ¯ ÙˆØ§Ù„ÙˆÙ‚Ù) ===
    function renderSurah(textAyahs, audioAyahs, surahNum) {
        const contentDiv = document.getElementById('content');
        let html = '';

        if (surahNum != 1 && surahNum != 9) {
            html += '<div class="basmalah">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ù±Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù</div>';
        }

        textAyahs.forEach((ayah, index) => {
            const audioUrl = audioAyahs[index].audio;
            const globalNum = ayah.number;
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Øµ Ù„Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø³Ø¬ÙˆØ¯ ÙˆØ§Ù„ÙˆÙ‚Ù
            let text = ayah.text;
            
            // ØªÙ„ÙˆÙŠÙ† Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø³Ø¬ÙˆØ¯ (Û)
            text = text.replace(/Û/g, '<span class="sujud-mark">Û</span>');
            
            // ØªÙ„ÙˆÙŠÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ÙˆÙ‚Ù (ÛšØŒ Û–ØŒ Û—ØŒ Û™ØŒ Û›)
            // Ù‡Ø°Ù‡ Ø§Ù„Ø±Ù…ÙˆØ² Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¹Ø«Ù…Ø§Ù†ÙŠ
            text = text.replace(/[ÛšÛ–Û—Û™Û›]/g, '<span class="waqf-mark">$&</span>');

            const isBookmarked = (localStorage.getItem('quranBookmark') === `${surahNum}-${ayah.numberInSurah}`);

            html += `
            <div class="ayah-container" id="ayah-box-${ayah.numberInSurah}">
                <div class="ayah-number">${ayah.numberInSurah}</div>
                <div class="ayah-text" onclick="playAudio('${audioUrl}', ${ayah.numberInSurah})">
                    ${text}
                </div>
                <div class="ayah-actions">
                    <button class="btn-action btn-play" onclick="playAudio('${audioUrl}', ${ayah.numberInSurah})" title="${translations[currentLang].play}">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="btn-action btn-tafsir" onclick="openTafsir(${globalNum})" title="${translations[currentLang].tafsir}">
                        <i class="fas fa-book-open"></i>
                    </button>
                    <button class="btn-action ${isBookmarked ? 'btn-saved' : 'btn-save'}" onclick="saveBookmark(${surahNum}, ${ayah.numberInSurah})" title="${translations[currentLang].save}">
                        <i class="${isBookmarked ? 'fas' : 'far'} fa-bookmark"></i>
                    </button>
                </div>
            </div>
            `;
        });
        contentDiv.innerHTML = html;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // === Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¢ÙŠØ© ===
    function goToAyah() {
        const num = document.getElementById('goInput').value;
        if (!num || num < 1) {
            showToast('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¢ÙŠØ© ØµØ­ÙŠØ­');
            return;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ø³ÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹
        const surahNum = document.getElementById('surahSelect').value;
        if (!surahNum) {
            showToast('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø³ÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }

        const el = document.getElementById(`ayah-box-${num}`);
        if (el) {
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // ØªØ£Ø«ÙŠØ± ÙˆÙ…ÙŠØ¶
            el.style.borderColor = '#FFD700';
            el.style.background = 'rgba(255, 215, 0, 0.1)';
            setTimeout(() => {
                el.style.background = '';
            }, 2000);
            showToast(`ğŸ“ Ø§Ù†ØªÙ‚Ù„Øª Ù„Ù„Ø¢ÙŠØ© ${num}`);
        } else {
            showToast('âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
    }

    // === Ø§Ù„ØªØ´ØºÙŠÙ„ ===
    function playAudio(url, ayahNum) {
        const audioPlayer = document.getElementById('mainAudio');
        audioPlayer.src = url;
        audioPlayer.play();
        document.getElementById('playerContainer').style.display = 'flex';
        
        document.getElementById('currentAyahLabel').innerHTML = `<i class="fas fa-music"></i> ${ayahNum}`;
        
        document.querySelectorAll('.ayah-container').forEach(el => el.style.borderColor = 'rgba(255,255,255,0.05)');
        const activeBox = document.getElementById(`ayah-box-${ayahNum}`);
        if(activeBox) {
            activeBox.style.borderColor = '#FFD700';
            activeBox.style.background = 'rgba(255, 215, 0, 0.05)';
        }
    }

    // === Ø§Ù„ØªÙØ³ÙŠØ± ===
    async function openTafsir(ayahGlobalNum) {
        const tafsirType = document.getElementById('tafsirSelect').value;
        const modal = document.getElementById('tafsirModal');
        const textDiv = document.getElementById('tafsirTextDisplay');
        modal.style.display = 'flex';
        textDiv.innerText = translations[currentLang].loadingTafsir;

        try {
            const res = await fetch(`https://api.alquran.cloud/v1/ayah/${ayahGlobalNum}/editions/${tafsirType}`);
            const data = await res.json();
            textDiv.innerText = (data.code === 200) ? data.data[0].text : "No Tafsir available.";
        } catch (e) {
            textDiv.innerText = "Error loading Tafsir.";
        }
    }

    function closeTafsir() {
        document.getElementById('tafsirModal').style.display = 'none';
    }

    // === Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¶Ø¹ ===
    function saveBookmark(surah, ayah) {
        const current = localStorage.getItem('quranBookmark');
        const key = `${surah}-${ayah}`;
        
        if(current === key) {
            localStorage.removeItem('quranBookmark');
            showToast('âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­ÙØ¸');
        } else {
            localStorage.setItem('quranBookmark', key);
            showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¶Ø¹');
        }
        
        if(document.getElementById('surahSelect').value == surah) {
            loadSurah();
        }
    }

    function goToBookmark() {
        const bookmark = localStorage.getItem('quranBookmark');
        if(!bookmark) {
            showToast('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¶Ø¹ Ù…Ø­ÙÙˆØ¸');
            return;
        }
        const [surah, ayah] = bookmark.split('-');
        document.getElementById('surahSelect').value = surah;
        loadSurah().then(() => {
            setTimeout(() => {
                const el = document.getElementById(`ayah-box-${ayah}`);
                if(el) {
                    el.scrollIntoView({behavior: "smooth", block: "center"});
                    el.style.borderColor = '#FFD700';
                    el.style.background = 'rgba(255, 215, 0, 0.1)';
                    setTimeout(() => el.style.background = '', 2000);
                }
            }, 500);
        });
    }

    // === Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===
    function changeFontSize(delta) {
        currentFontSize += (delta * 0.1);
        if(currentFontSize < 1.0) currentFontSize = 1.0;
        if(currentFontSize > 2.5) currentFontSize = 2.5;
        document.documentElement.style.setProperty('--ayah-font-size', currentFontSize + 'em');
        saveSettings();
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        const isLight = document.body.classList.contains('light-mode');
        document.getElementById('themeIcon').className = isLight ? 'fas fa-sun' : 'fas fa-moon';
        saveSettings();
    }

    function changeLang() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        document.documentElement.setAttribute('lang', currentLang);
        document.documentElement.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
        document.getElementById('langText').textContent = currentLang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
        
        document.querySelectorAll('[data-ar]').forEach(el => {
            el.textContent = el.getAttribute(`data-${currentLang}`);
        });
        saveSettings();
    }

    function saveSettings() {
        const settings = {
            fontSize: currentFontSize,
            theme: document.body.classList.contains('light-mode') ? 'light' : 'dark',
            lang: currentLang,
            tafsir: document.getElementById('tafsirSelect').value
        };
        localStorage.setItem('quranSettings', JSON.stringify(settings));
    }

    function loadSettings() {
        const settings = JSON.parse(localStorage.getItem('quranSettings'));
        if(settings) {
            currentFontSize = settings.fontSize || 1.6;
            document.documentElement.style.setProperty('--ayah-font-size', currentFontSize + 'em');
            
            if(settings.theme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('themeIcon').className = 'fas fa-sun';
            }
            
            if(settings.lang) {
                currentLang = settings.lang;
                if(currentLang === 'en') changeLang(); 
            }

            if(settings.tafsir) {
                document.getElementById('tafsirSelect').value = settings.tafsir;
            }
        }
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }
</script>

</body>
</html>