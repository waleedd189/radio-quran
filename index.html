<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>راديو قرآن v2 - صفحة اللهم لك الحمد</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Cairo', 'Arial', sans-serif;
      background: linear-gradient(to bottom right, #111, #333);
      color: #fff;
      text-align: center;
      padding: 30px 10px;
    }
    
    h1 {
      font-family: 'Amiri', serif;
      font-size: 3em;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      background: linear-gradient(45deg, #4CAF50, #81C784);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    h1::before {
      content: "﴿";
      color: #4CAF50;
      margin-left: 10px;
    }
    
    h1::after {
      content: "﴾";
      color: #4CAF50;
      margin-right: 10px;
    }
    
    .subtitle {
      font-size: 1.1em;
      margin-bottom: 30px;
      color: #ccc;
    }
    
    .prayer-times-panel {
      background: rgba(34, 34, 34, 0.9);
      border-radius: 10px;
      padding: 12px;
      margin: 15px auto;
      max-width: 600px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(76, 175, 80, 0.3);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }
    
    .prayer-times-title {
      font-family: 'Amiri', serif;
      font-size: 1.3em;
      color: #4CAF50;
      margin-bottom: 12px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    
    .prayer-times-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .prayer-time-item {
      background: rgba(76, 175, 80, 0.1);
      border-radius: 8px;
      padding: 8px 6px;
      border: 1px solid rgba(76, 175, 80, 0.2);
      transition: all 0.3s ease;
    }
    
    .prayer-time-item:hover {
      background: rgba(76, 175, 80, 0.2);
      transform: translateY(-2px);
    }
    
    .prayer-time-item.next-prayer {
      background: rgba(76, 175, 80, 0.3);
      border-color: #4CAF50;
      box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
    }
    
    .prayer-name {
      font-size: 0.75em;
      color: #ccc;
      margin-bottom: 3px;
    }
    
    .prayer-time {
      font-size: 0.9em;
      font-weight: 600;
      color: #4CAF50;
    }
    
    .next-prayer-info {
      background: rgba(76, 175, 80, 0.1);
      border-radius: 8px;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .next-prayer-text {
      font-size: 0.85em;
      color: #ccc;
      margin-bottom: 3px;
    }
    
    .next-prayer-countdown {
      font-size: 1em;
      font-weight: 600;
      color: #4CAF50;
    }
    
    .location-info {
      font-size: 0.75em;
      color: #aaa;
      margin-top: 8px;
    }
    
    .controls-panel {
      background: rgba(34, 34, 34, 0.8);
      border-radius: 10px;
      padding: 12px;
      margin: 15px auto;
      max-width: 500px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .now-playing {
      font-size: 1em;
      color: #4CAF50;
      margin-bottom: 10px;
      min-height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .playing-indicator {
      display: none;
      width: 16px;
      height: 16px;
      background: #4CAF50;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.1); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    .volume-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    
    .volume-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 50%;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .volume-btn:hover {
      background: #45a049;
      transform: scale(1.1);
    }
    
    .volume-display {
      font-size: 0.95em;
      color: #4CAF50;
      min-width: 50px;
    }
    
    .search-container {
      margin: 20px 0;
    }
    
    .search-input {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(76, 175, 80, 0.3);
      border-radius: 25px;
      padding: 12px 20px;
      color: white;
      font-size: 1em;
      width: 300px;
      max-width: 90%;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #4CAF50;
      background: rgba(255, 255, 255, 0.15);
    }
    
    .search-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }
    
    .playlist-controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 10px 0;
    }
    
    .playlist-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .playlist-btn:hover {
      background: #45a049;
      transform: translateY(-2px);
    }
    
    .playlist-btn:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      max-width: 1000px;
      margin: auto;
    }
    
    .card {
      background: #222;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 0 10px #000;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
      border-color: rgba(76, 175, 80, 0.5);
    }
    
    .card.active {
      border-color: #4CAF50;
      background: rgba(76, 175, 80, 0.1);
      box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
    }
    
    .card.hidden {
      display: none;
    }
    
    .card img {
      width: 100%;
      max-height: 160px;
      object-fit: cover;
      border-radius: 10px;
      transition: transform 0.3s ease;
    }
    
    .card:hover img {
      transform: scale(1.05);
    }
    
    .card h2 {
      font-size: 1em;
      margin: 10px 0;
    }
    
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 0.9em;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s ease;
    }
    
    button:hover {
      background-color: #45a049;
      transform: translateY(-2px);
    }
    
    .stop-btn {
      background-color: #f44336 !important;
    }
    
    .stop-btn:hover {
      background-color: #da190b !important;
    }
    
    .progress-bar {
      margin-top: 10px;
      height: 4px;
      width: 100%;
      background: #555;
      position: relative;
      overflow: hidden;
      border-radius: 2px;
    }
    
    .progress-bar::before {
      content: "";
      position: absolute;
      height: 100%;
      width: 30%;
      background: #4caf50;
      animation: move 2s linear infinite;
    }
    
    .card.active .progress-bar::before {
      animation: move 1s linear infinite;
      background: linear-gradient(90deg, #4caf50, #81c784, #4caf50);
    }
    
    @keyframes move {
      from { left: -30%; }
      to { left: 100%; }
    }
    
    footer {
      margin-top: 40px;
      font-size: 0.9em;
      color: #aaa;
    }
    
    a {
      color: #4caf50;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    a:hover {
      color: #81c784;
    }
    
    .time-display {
      font-size: 0.8em;
      color: #ccc;
      margin-top: 8px;
    }
    
    .whatsapp-float {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: #25D366;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 1000;
      border: none;
      text-decoration: none;
    }
    
    .whatsapp-float:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(37, 211, 102, 0.6);
    }
    
    .whatsapp-float svg {
      width: 32px;
      height: 32px;
      fill: white;
    }
    
    .whatsapp-tooltip {
      position: absolute;
      right: 70px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 0.85em;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      pointer-events: none;
    }
    
    .whatsapp-tooltip::after {
      content: '';
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      border: 6px solid transparent;
      border-left-color: rgba(0, 0, 0, 0.8);
    }
    
    .whatsapp-float:hover .whatsapp-tooltip {
      opacity: 1;
      visibility: visible;
    }

    @media (max-width: 768px) {
      .prayer-times-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      h1 {
        font-size: 2.5em;
      }
      
      .prayer-times-title {
        font-size: 1.2em;
      }
      
      .prayer-time-item {
        padding: 6px 4px;
      }
      
      .prayer-name {
        font-size: 0.7em;
      }
      
      .prayer-time {
        font-size: 0.8em;
      }
      
      .whatsapp-float {
        width: 50px;
        height: 50px;
        bottom: 15px;
        right: 15px;
      }
      
      .whatsapp-float svg {
        width: 26px;
        height: 26px;
      }
      
      .whatsapp-tooltip {
        right: 60px;
        font-size: 0.8em;
      }
    }
  </style>
</head>
<body>
  <h1>راديو قرآن</h1>
  <div class="subtitle">صفحة <a href="https://www.facebook.com/lakel7amd" target="_blank">اللهم لك الحمد</a></div>

  <!-- لوحة مواقيت الصلاة -->
  <div class="prayer-times-panel">
    <div class="prayer-times-title">مواقيت الصلاة</div>
    <div class="prayer-times-grid" id="prayerTimesGrid">
      <div class="prayer-time-item">
        <div class="prayer-name">الفجر</div>
        <div class="prayer-time" id="fajrTime">--:--</div>
      </div>
      <div class="prayer-time-item">
        <div class="prayer-name">الشروق</div>
        <div class="prayer-time" id="sunriseTime">--:--</div>
      </div>
      <div class="prayer-time-item">
        <div class="prayer-name">الظهر</div>
        <div class="prayer-time" id="dhuhrTime">--:--</div>
      </div>
      <div class="prayer-time-item">
        <div class="prayer-name">العصر</div>
        <div class="prayer-time" id="asrTime">--:--</div>
      </div>
      <div class="prayer-time-item">
        <div class="prayer-name">المغرب</div>
        <div class="prayer-time" id="maghribTime">--:--</div>
      </div>
      <div class="prayer-time-item">
        <div class="prayer-name">العشاء</div>
        <div class="prayer-time" id="ishaTime">--:--</div>
      </div>
    </div>
    <div class="next-prayer-info">
      <div class="next-prayer-text" id="nextPrayerText">الصلاة القادمة:</div>
      <div class="next-prayer-countdown" id="nextPrayerCountdown">--:--:--</div>
    </div>
    <div class="location-info" id="locationInfo">جاري تحديد الموقع...</div>
  </div>

  <div class="controls-panel">
    <div class="now-playing" id="nowPlaying">
      <div class="playing-indicator" id="playingIndicator"></div>
      <span id="stationName">اختر محطة للتشغيل</span>
    </div>
    
    <div class="volume-controls">
      <button class="volume-btn" onclick="decreaseVolume()" title="خفض الصوت">-</button>
      <div class="volume-display" id="volumeDisplay">50%</div>
      <button class="volume-btn" onclick="increaseVolume()" title="رفع الصوت">+</button>
    </div>
    
    <div class="playlist-controls">
      <button class="playlist-btn" onclick="previousStation()" id="prevBtn" disabled>السابق</button>
      <button class="playlist-btn" onclick="nextStation()" id="nextBtn" disabled>التالي</button>
    </div>
    
    <div class="time-display" id="timeDisplay"></div>
  </div>

  <div class="search-container">
    <input type="text" class="search-input" placeholder="ابحث عن محطة..." id="searchInput" onkeyup="searchStations()">
  </div>

  <div class="grid">
    <div class="card">
      <img src="https://7nen.do.am/_ph/6/1/660752318.jpg" alt="إذاعة القاهرة" />
      <h2>إذاعة القاهرة</h2>
      <button onclick="playRadio('https://stream.radiojar.com/8s5u5tpdtwzuv', 'إذاعة القاهرة', this)">تشغيل</button>
      <button class="stop-btn" onclick="stopRadio()">إيقاف</button>
      <div class="progress-bar"></div>
    </div>
    <div class="card">
      <img src="https://7nen.do.am/_ph/6/1/730393383.jpg" alt="إذاعة السعودية" />
      <h2>إذاعة السعودية</h2>
      <button onclick="playRadio('https://backup.qurango.net/radio/abdulrahman_alsudaes/أثير%20راديو.mp3', 'إذاعة السعودية', this)">تشغيل</button>
      <button class="stop-btn" onclick="stopRadio()">إيقاف</button>
      <div class="progress-bar"></div>
    </div>
    <div class="card">
      <img src="https://7nen.do.am/_ph/6/1/288946560.jpg" alt="إذاعة الرقية" />
      <h2>إذاعة الرقية</h2>
      <button onclick="playRadio('https://qurango.net/radio/roqiah', 'إذاعة الرقية', this)">تشغيل</button>
      <button class="stop-btn" onclick="stopRadio()">إيقاف</button>
      <div class="progress-bar"></div>
    </div>
  </div>

  <div class="grid" id="stations"></div>

  <footer>راديو قرآن - صفحة اللهم لك الحمد</footer>
  <audio id="radioPlayer" controls style="display:none;"></audio>

  <!-- زر الواتساب العائم -->
  <button class="whatsapp-float" onclick="reportBrokenLink(); return false;" title="الإبلاغ عن رابط معطل">
    <div class="whatsapp-tooltip">الإبلاغ عن رابط معطل</div>
    <svg viewBox="0 0 24 24">
      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.893 3.488"/>
    </svg>
  </button>

  <script>
    const stations = [
      { name: "الشيخ أحمد العجمي", img: "https://7nen.do.am/_ph/6/1/979378293.jpg", url: "https://qurango.net/radio/ahmad_alajmy.mp3" },
      { name: "الشيخ مشاري راشد", img: "https://7nen.do.am/_ph/6/1/526518923.jpg", url: "https://qurango.net/radio/mishary_alafasi.mp3" },
      { name: "الشيخ محمد جبريل", img: "https://7nen.do.am/_ph/6/1/844452129.jpg", url: "https://backup.qurango.net/radio/mohammed_jibreel" },
      { name: "الشيخ المنشاوي", img: "https://7nen.do.am/_ph/6/1/986606135.jpg", url: "https://backup.qurango.net/radio/mohammed_siddiq_alminshawi/أثير%20راديو.mp3" },
      { name: "الشيخ عبدالباسط", img: "https://7nen.do.am/_ph/6/1/788498118.jpg", url: "https://qurango.net/radio/abdulbasit_abdulsamad.mp3" },
      { name: "الشيخ الحصري", img: "https://7nen.do.am/_ph/6/1/650079361.jpg", url: "https://backup.qurango.net/radio/mahmoud_khalil_alhussary" },
      { name: "الشيخ إدريس أبكر", img: "https://7nen.do.am/_ph/6/1/695351424.jpg", url: "https://backup.qurango.net/radio/idrees_abkr" },
      { name: "الشيخ محمود علي البنا", img: "https://7nen.do.am/_ph/6/1/592190149.jpg", url: "https://backup.qurango.net/radio/mahmoud_ali__albanna" },
      { name: "الشيخ سعد الغامدي", img: "https://7nen.do.am/_ph/6/1/613525566.jpg", url: "https://backup.qurango.net/radio/saad_alghamdi" },
      { name: "الشيخ مصطفى إسماعيل", img: "https://7nen.do.am/_ph/6/1/49597189.jpg", url: "https://backup.qurango.net/radio/mustafa_ismail" },
      { name: "الشيخ مصطفى اللاهوني", img: "https://7nen.do.am/_ph/6/1/586864154.jpg", url: "https://backup.qurango.net/radio/mustafa_allahoni" },
      { name: "الشيخ عبدالرحمن الشحات", img: "https://7nen.do.am/_ph/6/1/397155617.jpg", url: "https://backup.qurango.net/radio/a_alshahhat" }
    ];

    const container = document.getElementById('stations');
    const player = document.getElementById('radioPlayer');
    const nowPlaying = document.getElementById('stationName');
    const playingIndicator = document.getElementById('playingIndicator');
    const volumeDisplay = document.getElementById('volumeDisplay');
    const timeDisplay = document.getElementById('timeDisplay');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    let currentStationIndex = -1;
    let allStations = [];
    let playStartTime = null;
    let timeInterval = null;
    let prayerTimes = {};
    let nextPrayerInterval = null;

    // إنشاء قائمة جميع المحطات (الثابتة + المتغيرة)
    function initializeStations() {
      allStations = [
        { name: "إذاعة القاهرة", url: "https://stream.radiojar.com/8s5u5tpdtwzuv" },
        { name: "إذاعة السعودية", url: "https://backup.qurango.net/radio/abdulrahman_alsudaes/أثير%20راديو.mp3" },
        { name: "إذاعة الرقية", url: "https://qurango.net/radio/roqiah" },
        ...stations
      ];
    }

    // إنشاء بطاقات المحطات
    stations.forEach((station, index) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${station.img}" alt="${station.name}" />
        <h2>${station.name}</h2>
        <button onclick="playRadio('${station.url}', '${station.name}', this)">تشغيل</button>
        <button class="stop-btn" onclick="stopRadio()">إيقاف</button>
        <div class="progress-bar"></div>
      `;
      container.appendChild(card);
    });

    // تشغيل المحطة
    function playRadio(url, stationName, buttonElement) {
      player.pause();
      player.src = url;
      player.volume = 0.5;
      
      // إزالة التأثير النشط من جميع البطاقات
      document.querySelectorAll('.card').forEach(card => card.classList.remove('active'));
      
      // إضافة التأثير النشط للبطاقة الحالية
      const currentCard = buttonElement.closest('.card');
      currentCard.classList.add('active');
      
      // تحديث المعلومات
      nowPlaying.textContent = stationName;
      playingIndicator.style.display = 'block';
      
      // العثور على فهرس المحطة الحالية
      currentStationIndex = allStations.findIndex(station => station.url === url);
      updatePlaylistButtons();
      
      // بدء التشغيل
      player.play().then(() => {
        playStartTime = Date.now();
        startTimeCounter();
      }).catch(error => {
        console.error('خطأ في التشغيل:', error);
        nowPlaying.textContent = 'خطأ في تشغيل المحطة';
        playingIndicator.style.display = 'none';
      });
    }

    // إيقاف التشغيل
    function stopRadio() {
      player.pause();
      player.src = "";
      nowPlaying.textContent = "اختر محطة للتشغيل";
      playingIndicator.style.display = 'none';
      
      // إزالة التأثير النشط من جميع البطاقات
      document.querySelectorAll('.card').forEach(card => card.classList.remove('active'));
      
      currentStationIndex = -1;
      updatePlaylistButtons();
      stopTimeCounter();
    }

    // التحكم في الصوت
    function increaseVolume() {
      if (player.volume < 1) {
        player.volume = Math.min(1, player.volume + 0.1);
        updateVolumeDisplay();
      }
    }

    function decreaseVolume() {
      if (player.volume > 0) {
        player.volume = Math.max(0, player.volume - 0.1);
        updateVolumeDisplay();
      }
    }

    function updateVolumeDisplay() {
      volumeDisplay.textContent = Math.round(player.volume * 100) + '%';
    }

    // البحث عن المحطات
    function searchStations() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const cards = document.querySelectorAll('.card');
      
      cards.forEach(card => {
        const stationName = card.querySelector('h2').textContent.toLowerCase();
        if (stationName.includes(searchTerm)) {
          card.classList.remove('hidden');
        } else {
          card.classList.add('hidden');
        }
      });
    }

    // التنقل في قائمة التشغيل
    function previousStation() {
      if (currentStationIndex > 0) {
        const prevStation = allStations[currentStationIndex - 1];
        const cards = document.querySelectorAll('.card');
        const targetCard = Array.from(cards).find(card => 
          card.querySelector('h2').textContent === prevStation.name
        );
        if (targetCard) {
          const playButton = targetCard.querySelector('button:not(.stop-btn)');
          playButton.click();
        }
      }
    }

    function nextStation() {
      if (currentStationIndex < allStations.length - 1) {
        const nextStation = allStations[currentStationIndex + 1];
        const cards = document.querySelectorAll('.card');
        const targetCard = Array.from(cards).find(card => 
          card.querySelector('h2').textContent === nextStation.name
        );
        if (targetCard) {
          const playButton = targetCard.querySelector('button:not(.stop-btn)');
          playButton.click();
        }
      }
    }

    function updatePlaylistButtons() {
      prevBtn.disabled = currentStationIndex <= 0;
      nextBtn.disabled = currentStationIndex >= allStations.length - 1 || currentStationIndex === -1;
    }

    // عداد الوقت
    function startTimeCounter() {
      timeInterval = setInterval(() => {
        if (playStartTime) {
          const elapsed = Math.floor((Date.now() - playStartTime) / 1000);
          const minutes = Math.floor(elapsed / 60);
          const seconds = elapsed % 60;
          timeDisplay.textContent = `وقت التشغيل: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
      }, 1000);
    }

    function stopTimeCounter() {
      if (timeInterval) {
        clearInterval(timeInterval);
        timeInterval = null;
      }
      timeDisplay.textContent = '';
      playStartTime = null;
    }

    // وظائف مواقيت الصلاة
    async function getUserLocation() {
      return new Promise((resolve, reject) => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            position => {
              resolve({
                latitude: position.coords.latitude,
                longitude: position.coords.longitude
              });
            },
            error => {
              console.error('خطأ في تحديد الموقع:', error);
              // استخدام موقع افتراضي (القاهرة)
              resolve({
                latitude: 30.0444,
                longitude: 31.2357
              });
            }
          );
        } else {
          // استخدام موقع افتراضي (القاهرة)
          resolve({
            latitude: 30.0444,
            longitude: 31.2357
          });
        }
      });
    }

    async function fetchPrayerTimes() {
      try {
        const location = await getUserLocation();
        const today = new Date();
        const dateString = today.toISOString().split('T')[0];
        
        // استخدام timestamp بدلاً من التاريخ لضمان التوقيت الصحيح
        const timestamp = Math.floor(today.getTime() / 1000);
        
        const response = await fetch(
          `https://api.aladhan.com/v1/timings/${timestamp}?latitude=${location.latitude}&longitude=${location.longitude}&method=5&adjustment=0`
        );
        
        if (!response.ok) {
          throw new Error('فشل في جلب مواقيت الصلاة');
        }
        
        const data = await response.json();
        const timings = data.data.timings;
        
        prayerTimes = {
          fajr: timings.Fajr,
          sunrise: timings.Sunrise,
          dhuhr: timings.Dhuhr,
          asr: timings.Asr,
          maghrib: timings.Maghrib,
          isha: timings.Isha
        };
        
        updatePrayerTimesDisplay();
        updateLocationInfo(data.data.meta.timezone);
        startNextPrayerCountdown();
        
      } catch (error) {
        console.error('خطأ في جلب مواقيت الصلاة:', error);
        document.getElementById('locationInfo').textContent = 'خطأ في جلب مواقيت الصلاة';
      }
    }

    function updatePrayerTimesDisplay() {
      document.getElementById('fajrTime').textContent = formatTime(prayerTimes.fajr);
      document.getElementById('sunriseTime').textContent = formatTime(prayerTimes.sunrise);
      document.getElementById('dhuhrTime').textContent = formatTime(prayerTimes.dhuhr);
      document.getElementById('asrTime').textContent = formatTime(prayerTimes.asr);
      document.getElementById('maghribTime').textContent = formatTime(prayerTimes.maghrib);
      document.getElementById('ishaTime').textContent = formatTime(prayerTimes.isha);
    }

    function formatTime(timeString) {
      // تحويل الوقت إلى التوقيت المحلي
      const [hours, minutes] = timeString.split(':');
      const date = new Date();
      date.setHours(parseInt(hours), parseInt(minutes), 0, 0);
      
      // تنسيق الوقت بالتوقيت المحلي
      const localTime = date.toLocaleTimeString('ar-EG', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
      });
      
      return localTime;
    }

    function updateLocationInfo(timezone) {
      document.getElementById('locationInfo').textContent = `المنطقة الزمنية: ${timezone}`;
    }

    function getNextPrayer() {
      const now = new Date();
      const currentTime = now.getHours() * 60 + now.getMinutes();
      
      const prayers = [
        { name: 'الفجر', time: prayerTimes.fajr },
        { name: 'الشروق', time: prayerTimes.sunrise },
        { name: 'الظهر', time: prayerTimes.dhuhr },
        { name: 'العصر', time: prayerTimes.asr },
        { name: 'المغرب', time: prayerTimes.maghrib },
        { name: 'العشاء', time: prayerTimes.isha }
      ];
      
      for (let prayer of prayers) {
        const [hours, minutes] = prayer.time.split(':');
        const prayerTime = parseInt(hours) * 60 + parseInt(minutes);
        
        if (prayerTime > currentTime) {
          return { ...prayer, timeInMinutes: prayerTime };
        }
      }
      
      // إذا لم نجد صلاة اليوم، فالصلاة القادمة هي فجر الغد
      const [hours, minutes] = prayers[0].time.split(':');
      return { 
        ...prayers[0], 
        timeInMinutes: parseInt(hours) * 60 + parseInt(minutes) + 24 * 60 
      };
    }

    function startNextPrayerCountdown() {
      nextPrayerInterval = setInterval(() => {
        const nextPrayer = getNextPrayer();
        const now = new Date();
        const currentTime = now.getHours() * 60 + now.getMinutes();
        
        let timeDiff = nextPrayer.timeInMinutes - currentTime;
        if (timeDiff < 0) {
          timeDiff += 24 * 60; // إضافة يوم كامل
        }
        
        const hours = Math.floor(timeDiff / 60);
        const minutes = timeDiff % 60;
        
        document.getElementById('nextPrayerText').textContent = `الصلاة القادمة: ${nextPrayer.name}`;
        document.getElementById('nextPrayerCountdown').textContent = 
          `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        
        // تمييز الصلاة القادمة
        document.querySelectorAll('.prayer-time-item').forEach(item => {
          item.classList.remove('next-prayer');
        });
        
        const prayerNames = ['الفجر', 'الشروق', 'الظهر', 'العصر', 'المغرب', 'العشاء'];
        const nextPrayerIndex = prayerNames.indexOf(nextPrayer.name);
        if (nextPrayerIndex !== -1) {
          document.querySelectorAll('.prayer-time-item')[nextPrayerIndex].classList.add('next-prayer');
        }
      }, 1000);
    }

    // وظيفة الإبلاغ عن رابط معطل عبر الواتساب
    function reportBrokenLink() {
      const phoneNumber = '+201092116092';
      const message = 'يوجد رابط معطل في راديو القرآن، يرجى التحقق';
      const whatsappUrl = `https://wa.me/${phoneNumber.replace('+', '')}?text=${encodeURIComponent(message)}`;
      
      // فتح الواتساب في نافذة جديدة
      window.open(whatsappUrl, '_blank');
      
      // منع الرابط الافتراضي
      return false;
    }

    // اختصارات لوحة المفاتيح
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        if (player.src && !player.paused) {
          stopRadio();
        } else if (currentStationIndex >= 0) {
          const currentStation = allStations[currentStationIndex];
          const cards = document.querySelectorAll('.card');
          const targetCard = Array.from(cards).find(card => 
            card.querySelector('h2').textContent === currentStation.name
          );
          if (targetCard) {
            const playButton = targetCard.querySelector('button:not(.stop-btn)');
            playButton.click();
          }
        }
      } else if (e.code === 'ArrowLeft') {
        previousStation();
      } else if (e.code === 'ArrowRight') {
        nextStation();
      } else if (e.code === 'ArrowUp') {
        e.preventDefault();
        increaseVolume();
      } else if (e.code === 'ArrowDown') {
        e.preventDefault();
        decreaseVolume();
      }
    });

    // تهيئة التطبيق
    initializeStations();
    updateVolumeDisplay();
    updatePlaylistButtons();
    fetchPrayerTimes();
  </script>
</body>
</html>

