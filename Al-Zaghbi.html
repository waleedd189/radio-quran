<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>دروس الشيخ محمد عبد الملك الزغبي</title>
  <!-- الخطوط والأيقونات -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== متغيرات التصميم ===== */
    :root {
      --primary-color: #4CAF50;
      --secondary-color: #FF9800;
      --third-color: #2196F3;
      --fourth-color: #9C27B0;
      --fifth-color: #F44336;
      --sixth-color: #00BCD4;
      --background-color: #111;
      --card-background: rgba(34, 34, 34, 0.9);
      --text-color: #fff;
    }
    /* ===== الأساسيات ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Cairo', 'Arial', sans-serif;
      background: linear-gradient(135deg, #111 0%, #333 100%);
      color: var(--text-color);
      text-align: center;
      padding: 30px 10px;
      overflow-x: hidden;
      min-height: 100vh;
    }
    /* ===== العناوين ===== */
    h1 {
      font-family: 'Amiri', serif;
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      background: linear-gradient(45deg, var(--primary-color), #81C784);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    h1::before, h1::after {
      content: "﴿";
      color: var(--primary-color);
      margin: 0 10px;
      font-size: 1.2em;
    }
    h1::after {
      content: "﴾";
    }
    .subtitle {
      font-size: 1.1em;
      margin-bottom: 15px;
      color: #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .subtitle a {
      color: inherit;
      text-decoration: none;
      background: linear-gradient(45deg, var(--primary-color), #81C784);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: transform 0.3s ease;
      font-weight: 600;
    }
    .subtitle a:hover {
      transform: scale(1.05);
    }
    /* ===== أزرار التحكم ===== */
    .controls-container {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      display: flex;
      gap: 10px;
      flex-direction: column;
    }
    .control-btn {
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 25px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    .back-btn { background: var(--third-color); }
    .share-btn { background: var(--primary-color); }
    .sleep-timer-btn { background: var(--fourth-color); }
    .wait-btn { background: var(--sixth-color); }
    .control-btn.active {
      box-shadow: 0 0 15px currentColor;
    }
    /* ===== مشغل الوسائط ===== */
    .player-container {
      background: var(--card-background);
      border-radius: 20px;
      padding: 25px;
      margin: 25px auto;
      max-width: 700px;
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .now-playing {
      font-size: 1.2em;
      color: var(--primary-color);
      margin-bottom: 20px;
      min-height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .playing-indicator {
      width: 14px;
      height: 14px;
      background: var(--primary-color);
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
      100% { opacity: 1; transform: scale(1); }
    }
    .loader {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255,255,255,0.3);
      border-bottom-color: white;
      border-radius: 50%;
      display: inline-block;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
    }
    @keyframes rotation {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .media-player {
      width: 100%;
      border-radius: 10px;
      background: rgba(0,0,0,0.3);
      margin-bottom: 15px;
    }
    .media-player video {
      width: 100%;
      max-height: 300px;
      border-radius: 10px 10px 0 0;
      object-fit: cover;
    }
    .media-player audio {
      width: 100%;
      border-radius: 0 0 10px 10px;
      height: 40px;
    }
    .media-type-toggle {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .media-type-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9em;
    }
    .media-type-btn.active {
      background: var(--secondary-color);
      border-color: var(--secondary-color);
    }
    .media-type-btn:hover {
      background: rgba(255,255,255,0.2);
    }
    .media-type-btn.active:hover {
      background: #F57C00;
    }
    /* ===== حاوية المحطات ===== */
    .stations-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      margin: 30px auto;
      max-width: 1400px;
      padding: 0 15px;
    }
    /* ===== بطاقة الدروس ===== */
    .lessons-container {
      background: var(--card-background);
      border-radius: 20px;
      padding: 25px;
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }
    .lessons-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    .lessons-container.active::before {
      transform: scaleX(1);
    }
    .lessons-container:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.4);
    }
    .station-image {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      margin: 0 auto 20px;
      border: 5px solid rgba(255,255,255,0.2);
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
      transition: all 0.4s ease;
      object-fit: cover;
    }
    .lessons-container:hover .station-image {
      transform: scale(1.08);
      border-color: rgba(255,255,255,0.5);
    }
    .lessons-title {
      font-family: 'Amiri', serif;
      font-size: 1.4em;
      margin-bottom: 20px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
      position: relative;
      padding-bottom: 12px;
    }
    .lessons-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 3px;
      background: var(--secondary-color);
      border-radius: 2px;
    }
    .lessons-dropdown {
      width: 100%;
      padding: 12px 15px;
      border-radius: 12px;
      background: rgba(255,255,255,0.1);
      border: 2px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1em;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      -webkit-appearance: none;
      appearance: none;
      background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FF9800%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13%205.7L146.2%20202.7%2018.5%2075.1a17.6%2017.6%200%200%200-24.7%2024.7l130.4%20130.4c6.9%206.9%2017.9%206.9%2024.8%200l130.4-130.4c6.9-6.9%206.9-18.1-.1-24.9z%22%2F%3E%3C%2Fsvg%3E');
      background-repeat: no-repeat;
      background-position: left 15px center;
      background-size: 12px;
      padding-left: 40px;
    }
    .lessons-dropdown:focus {
      outline: none;
      border-color: var(--secondary-color);
      background: rgba(255,255,255,0.15);
    }
    .lessons-dropdown option {
      background: #333;
      color: white;
      padding: 10px;
    }
    .lesson-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .play-lesson-btn {
      flex: 1;
      background: var(--secondary-color);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 600;
    }
    .play-lesson-btn:hover {
      background: #F57C00;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,152,0,0.3);
    }
    .stop-btn {
      background: var(--fifth-color) !important;
      flex: 0 0 45px;
      padding: 12px;
    }
    .stop-btn:hover {
      background: #D32F2F !important;
    }
    .progress-bar {
      height: 4px;
      width: 100%;
      background: rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
      border-radius: 2px;
      margin-top: 15px;
    }
    .progress-bar::before {
      content: "";
      position: absolute;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
      animation: move 3s linear infinite;
    }
    .lessons-container.active .progress-bar::before {
      width: 100%;
      animation: move 2s linear infinite;
    }
    @keyframes move {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    /* ===== التذييل ===== */
    footer {
      margin-top: 50px;
      padding: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    .footer-text {
      font-size: 0.9em;
      color: #aaa;
      margin-bottom: 10px;
    }
    .footer-special-text {
      font-family: 'Amiri', serif;
      font-size: 1.2em;
      color: var(--secondary-color);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      font-weight: 600;
    }
    /* ===== زر الواتساب ===== */
    .whatsapp-float {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 60px;
      height: 60px;
      background: #25D366;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 25px rgba(37,211,102,0.5);
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 1000;
      border: none;
    }
    .whatsapp-float:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 30px rgba(37,211,102,0.6);
    }
    .whatsapp-float svg {
      width: 30px;
      height: 30px;
      fill: white;
    }
    /* ===== النوافذ المنبثقة ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }
    .modal-content {
      background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      animation: modalFadeIn 0.4s ease;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    .modal-title {
      font-size: 1.4em;
      margin-bottom: 20px;
      color: white;
      font-weight: 600;
      text-align: center;
    }
    .timer-options {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 25px;
    }
    .timer-option {
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 10px;
      padding: 15px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1em;
      font-weight: 500;
    }
    .timer-option:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }
    .timer-option.selected {
      background: var(--fourth-color);
      box-shadow: 0 0 15px rgba(156,39,176,0.5);
    }
    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 15px;
    }
    .modal-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    .modal-cancel {
      background: rgba(255,255,255,0.2);
    }
    .modal-cancel:hover {
      background: rgba(255,255,255,0.3);
    }
    .modal-confirm {
      background: var(--fourth-color);
    }
    .modal-confirm:hover {
      background: #7B1FA2;
    }
    .timer-status {
      margin-top: 20px;
      padding: 15px;
      background: rgba(156,39,176,0.1);
      border-radius: 12px;
      color: var(--fourth-color);
      font-size: 1em;
      display: none;
      text-align: center;
      border: 1px solid rgba(156,39,176,0.2);
    }
    /* ===== للهواتف ===== */
    @media (max-width: 768px) {
      h1 { font-size: 2em; }
      .subtitle { font-size: 1em; }
      .station-image {
        width: 150px;
        height: 150px;
      }
      .controls-container { 
        top: 15px; 
        left: 15px;
        gap: 8px;
      }
      .control-btn { 
        font-size: 0.8em; 
        padding: 8px 12px;
      }
      .whatsapp-float { 
        width: 55px; 
        height: 55px; 
        bottom: 20px; 
        right: 20px; 
      }
      .whatsapp-float svg { 
        width: 26px; 
        height: 26px; 
      }
      .timer-options {
        grid-template-columns: repeat(2, 1fr);
      }
      .stations-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .modal-content {
        padding: 25px 20px;
      }
      .media-player video {
        max-height: 200px;
      }
    }
  </style>
</head>
<body>
  <!-- ===== أزرار التحكم ===== -->
  <div class="controls-container">
    <button class="control-btn back-btn" onclick="goBack()">
      <i class="fas fa-arrow-right"></i>
      <span>رجوع</span>
    </button>
    <button class="control-btn share-btn" onclick="shareApp()">
      <i class="fas fa-share-alt"></i>
      <span>مشاركة</span>
    </button>
    <button class="control-btn sleep-timer-btn" id="sleepTimerBtn" onclick="toggleSleepTimer()">
      <i class="fas fa-clock"></i>
      <span>مؤقت النوم</span>
    </button>
    <button class="control-btn wait-btn" id="waitBtn" onclick="toggleWait()">
      <i class="fas fa-hourglass-half"></i>
      <span>انتظار</span>
    </button>
  </div>
  <!-- ===== العنوان الرئيسي ===== -->
  <h1>
    <span>دروس الشيخ محمد عبد الملك الزغبي</span>
  </h1>
  <!-- ===== العنوان الفرعي ===== -->
  <div class="subtitle">
    <span>صفحة</span>
    <a href="https://www.facebook.com/lakel7amd" target="_blank">اللهم لك الحمد</a>
  </div>
  <!-- ===== مشغل الوسائط ===== -->
  <div class="player-container">
    <div class="now-playing" id="nowPlaying">
      <div class="playing-indicator" id="playingIndicator" style="display: none;"></div>
      <div class="loader" id="bufferingLoader" style="display: none;"></div>
      <span id="currentLesson">اختر درساً للاستماع</span>
    </div>
    
    <div class="media-type-toggle" id="mediaTypeToggle" style="display: none;">
      <button class="media-type-btn active" id="audioBtn" onclick="switchToAudio()">
        <i class="fas fa-headphones"></i>
        صوت فقط
      </button>
      <button class="media-type-btn" id="videoBtn" onclick="switchToVideo()">
        <i class="fas fa-video"></i>
        فيديو
      </button>
    </div>
    
    <div class="media-player" id="mediaPlayer">
      <video id="videoPlayer" style="display: none;" controls></video>
      <audio id="audioPlayer" controls style="width: 100%; border-radius: 10px; height: 40px;"></audio>
    </div>
    
    <div class="timer-status" id="timerStatus">
      <i class="fas fa-clock"></i>
      مؤقت النوم مفعل: <span id="timerCountdown">--:--</span>
    </div>
  </div>
  <!-- ===== حاوية المحطات ===== -->
  <div class="stations-container" id="stationsContainer">
    <!-- سيتم إنشاء المحتوى هنا بواسطة JavaScript -->
  </div>
  <!-- ===== التذييل ===== -->
  <footer>
    <div class="footer-text">راديو قرآن - صفحة اللهم لك الحمد</div>
    <div class="footer-special-text">دروس الشيخ محمد عبد الملك الزغبي</div>
  </footer>
  <!-- ===== زر الواتساب ===== -->
  <button class="whatsapp-float" onclick="reportBrokenLink(); return false;" id="whatsappBtn">
    <svg viewBox="0 0 24 24">
      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.520.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.520-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.893 3.488"/>
    </svg>
  </button>
  <!-- ===== نافذة مؤقت النوم ===== -->
  <div class="modal" id="sleepTimerModal">
    <div class="modal-content">
      <div class="modal-title">
        <i class="fas fa-moon"></i>
        مؤقت النوم
      </div>
      <div class="timer-options">
        <button class="timer-option" data-minutes="5">5 دقائق</button>
        <button class="timer-option" data-minutes="10">10 دقائق</button>
        <button class="timer-option" data-minutes="15">15 دقيقة</button>
        <button class="timer-option" data-minutes="30">30 دقيقة</button>
        <button class="timer-option" data-minutes="45">45 دقيقة</button>
        <button class="timer-option" data-minutes="60">60 دقيقة</button>
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-cancel" onclick="closeSleepTimerModal()">إلغاء</button>
        <button class="modal-btn modal-confirm" onclick="setSleepTimer()">تأكيد</button>
      </div>
    </div>
  </div>
  <!-- ===== نافذة الانتظار ===== -->
  <div class="modal" id="waitModal">
    <div class="modal-content">
      <div class="modal-title">
        <i class="fas fa-hourglass-half"></i>
        وضع الانتظار
      </div>
      <div class="wait-message" style="margin: 20px 0; color: #ccc; line-height: 1.6;">
        سيتم تشغيل الدرس التالي تلقائياً بعد انتهاء الدرس الحالي. هل تريد تفعيل وضع الانتظار؟
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-cancel" onclick="closeWaitModal()">إلغاء</button>
        <button class="modal-btn modal-confirm" onclick="enableWaitMode()">تفعيل</button>
      </div>
    </div>
  </div>

  <script>
    // ===== بيانات الدروس =====
    const lessonsData = {
      series: [
        {
          id: 1,
          title: "سلسلة يعلّمون الناس السحر",
          image: "https://i.postimg.cc/Yq2JK9ng/image.jpg",
          color: "#FF9800",
          lessons: [
            { name: "تعريف السحر 1", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/001-1_up_by_muslem.mp4" },
            { name: "تعريف السحر 2", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/002-2_up_by_muslem.mp4" },
            { name: "أخطاء يقع فيها المعالجون", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/003-_up_by_muslem.mp4" },
            { name: "عمَّار البيوت 1", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/004-1_up_by_muslem.mp4" },
            { name: "عمَّار البيوت 2", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/005-2_up_by_muslem.mp4" },
            { name: "الوقاية خيرٌ من العلاج", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/006-_up_by_muslem.mp4" },
            { name: "أعراض السحر وعلاجه", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/007-_up_by_muslem.mp4" },
            { name: "أشكال الأذى التي يتعرض لها المسحور", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/008-_up_by_muslem.mp4" },
            { name: "علاج السحر بعد وقوعه", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/009-_up_by_muslem.mp4" },
            { name: "علاج سحر عدم الإنجاب والإجهاض", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/010-_up_by_muslem.mp4" },
            { name: "علاج السحر عامة", url: "https://archive.org/download/Al-Sehr_Alzoghby_uP_bY_mUSLEm/011-_up_by_muslem.mp4" }
          ]
        },
        {
          id: 2,
          title: "سلسلة القيامة كأنك تراها",
          image: "https://i.postimg.cc/6QDygFBc/image.webp",
          color: "#F44336",
          lessons: [
            { name: "عظمة ربنا", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/001-_up_by_muslem.mp4" },
            { name: "يوم القيامة", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/002-_up_by_muslem.mp4" },
            { name: "يوم القيامة 2", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/003-2_up_by_muslem.mp4" },
            { name: "يوم الحسرة والندامة", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/004-_up_by_muslem.mp4" },
            { name: "مواقف يوم الحسرة والندامة", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/005-_up_by_muslem.mp4" },
            { name: "يوم الخروج", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/006-_up_by_muslem.mp4" },
            { name: "يوم الخروج 2", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/007-2_up_by_muslem.mp4" },
            { name: "يوم الزلزلة", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/008-_up_by_muslem.mp4" },
            { name: "يوم الزلزلة 2", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/009-2_up_by_muslem.mp4" },
            { name: "الساعة 1", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/010-1_uP_bY_mUSLEm.mp4" },
            { name: "احداث سيناء", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/011-_up_by_muslem.mp4" },
            { name: "الساعة 2", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/012-2_uP_bY_mUSLEm.mp4" },
            { name: "الساعة 3", url: "https://archive.org/download/Alqiamah_Zoghbi_uP_bY_mUSLEm/013-3_uP_bY_mUSLEm.mp4" }
          ]
        },
        {
          id: 3,
          title: "سلسلة حياة السعداء",
          image: "https://i.postimg.cc/Yq2JK9ng/image.jpg",
          color: "#00BCD4",
          lessons: [
            { name: "مقدمة للسلسلة", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/001_muslem.ettounsi.mp3" },
            { name: "السعادة فى تأسيس البيت", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/002_muslem.ettounsi.mp3" },
            { name: "اختيار الزوجين", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/003_muslem.ettounsi.mp3" },
            { name: "الخطبة الشرعية وأحكامها", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/004_muslem.ettounsi.mp3" },
            { name: "بعض المخالفات المترتبة على الخطبة 1", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/005_muslem.ettounsi.mp3" },
            { name: "عض المخالفات المترتبة على الخطبة 2", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/006_muslem.ettounsi.mp3" },
            { name: "أحكام المهر 1", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/007_muslem.ettounsi.mp3" },
            { name: "أحكام المهر 2", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/008_muslem.ettounsi.mp3" },
            { name: "أحكام العقد", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/009_muslem.ettounsi.mp3" },
            { name: "الحقوق الزوجية", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/010_muslem.ettounsi.mp3" },
            { name: "حقوق الزوج على الزوجة 1", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/011_muslem.ettounsi.mp3" },
            { name: "حقوق الزوج على الزوجة 2", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/012_muslem.ettounsi.mp3" },
            { name: "حقوق الزوج على الزوجة 3", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/013_muslem.ettounsi.mp3" },
            { name: "حقوق الزوجة على زوجها 1", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/014_muslem.ettounsi.mp3" },
            { name: "حقوق الزوجة على زوجها 2", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/015_muslem.ettounsi.mp3" },
            { name: "حقوق الزوجة على زوجها 3", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/016_muslem.ettounsi.mp3" },
            { name: "الحقوق المشتركة بين الزوجين", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/017_muslem.ettounsi.mp3" },
            { name: "رعاية الإسلام للجنين 1", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/018_muslem.ettounsi.mp3" },
            { name: "رعاية الإسلام للجنين 2", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/019_muslem.ettounsi.mp3" },
            { name: "البشارى والتهنئة للمولود", url: "https://archive.org/download/Islamic_Tape-721_uP_bY_mUSLEm/020_muslem.ettounsi.mp3" }
          ]
        },
        {
          id: 4,
          title: "المكتبة الصوتية للشيخ محمد بن عبد الملك الزغبي",
          image: "https://i.postimg.cc/Yq2JK9ng/image.jpg",
          color: "#795548",
          lessons: [
            { name: "116SaFArbela", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/116SaFArbela.mp3" },
            { name: "121SeHamalail", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/121SeHamalail.mp3" },
            { name: "عاقبة الفساد", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/3aqbt_alfasad.mp3" },
            { name: "عاقبة الظلم", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/3aqbt_alzolm.mp3" },
            { name: "عاشق الشهادة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/3ashek_alshehada.mp3" },
            { name: "عندما كلم الله موسى", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/3endama_kalem.mp3" },
            { name: "ساعة التوبة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/6hor_elta7ot.mp3" },
            { name: "حمزة أسد الله", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/7amza_asa2d.mp3" },
            { name: "حسرات العصاة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/7asarat_al3osah.mp3" },
            { name: "حذاري من الدنيا", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/7azare_men_eldonya.mp3" },
            { name: "حسن الظن بالله", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/7osen_elzan.mp3" },
            { name: "8_2_8", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/8_2_8.mp3" },
            { name: "أبطال فى ساحة البلاء", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/abtal_fe_sa7at_elbala2.mp3" },
            { name: "أهل النار", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/ahl_alnar.mp3" },
            { name: "أخوة الدين", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/akhawat_elden.mp3" },
            { name: "التوبة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/alTawobaa.mp3" },
            { name: "الزنا", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/alZonaT.mp3" },
            { name: "الجهاد فقة وعلم وضوابط", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/alghad_faqeh.mp3" },
            { name: "القلب الأسير", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/alkalb_al2ser.mp3" },
            { name: "المرأة الجوهرة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/almar2a_elgawhara.mp3" },
            { name: "المسيح الدجال", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/almase7_aldagal.mp3" },
            { name: "الموت والحياة البرزخية", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/almaut_we_el7ayah_elbarza7yah.mp3" },
            { name: "قبسات من سورة القصص", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/alqass_alqran.mp3" },
            { name: "القطان", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/alqatan.mp3" },
            { name: "القنطرة التى بين الجنة والنار", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/alqntaraa.mp3" },
            { name: "التوسل المشروع والتوسل الممنوع", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/altawasol.mp3" },
            { name: "اليهود", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/alyahod.mp3" },
            { name: "أقوى وأخطر الأسلحة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/aqwa_wa_akhtar_al2sla7a.mp3" },
            { name: "أولياء الرحمن", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/awlya2_alrahman.mp3" },
            { name: "اوقات الشدة والاحوال", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/awqat_alsheda.mp3" },
            { name: "إبتلاء الصالحين", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_001.mp3" },
            { name: "أمَّن يجيب المضطر", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_002.mp3" },
            { name: "أصل اليهود", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_003.mp3" },
            { name: "الأمر بالمعروف", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_004.mp3" },
            { name: "الحرب مع إسرائيل", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_005.mp3" },
            { name: "الشهداء منازل وقصص", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_006.mp3" },
            { name: "الصراع بين الحق والباطل", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_007.mp3" },
            { name: "d_008", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_008.mp3" },
            { name: "الفتن والملاحم", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_009.mp3" },
            { name: "صبر الموحدين", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_010.mp3" },
            { name: "أسد الله", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_011.mp3" },
            { name: "مداخل الشيطان", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_012.mp3" },
            { name: "لو أقسم على الله لأبره", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_014.mp3" },
            { name: "أقسام الناس مع القرآن", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_015.mp3" },
            { name: "المشتاقون إلى الجنة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_016.mp3" },
            { name: "الطريق إلى الأقصى", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_017.mp3" },
            { name: "الذين عاشو بعد الموت", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_018.mp3" },
            { name: "صرخة إلى كل موحد", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_019.mp3" },
            { name: "زهد الموحدين", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_020.mp3" },
            { name: "هو الله", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_021.mp3" },
            { name: "عمر بن عبد العزيز", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_022.mp3" },
            { name: "فقد الأولاد", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_023.mp3" },
            { name: "علو الهمة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_024.mp3" },
            { name: "نور الدين محمود زنكي", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_025.mp3" },
            { name: "بحر الدموع", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_026.mp3" },
            { name: "وصف النار", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_027.mp3" },
            { name: "عظماء عند الموت", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_028.mp3" },
            { name: "عد إلى الله أيها العاصي", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_029.mp3" },
            { name: "سل الرزاق", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_030.mp3" },
            { name: "جهاد السلف الصالح", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_031.mp3" },
            { name: "جهاد الأبطال", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_032.mp3" },
            { name: "ويحك ياظلوم", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_033.mp3" },
            { name: "آلام المسيح", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_034.mp3" },
            { name: "مقتل الحسين", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_035.mp3" },
            { name: "تارك الصلاة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_036.mp3" },
            { name: "نهاية ظالم", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_037.mp3" },
            { name: "عذاب القبر ونعيمه", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_038.mp3" },
            { name: "منزلة الشهداء عند الله رب العالمين", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_039.mp3" },
            { name: "الهزيمة النفسية وقتال الأبطال", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_040.mp3" },
            { name: "فساد فرعون وفساد اليهود", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/d_041.mp3" },
            { name: "دلائل الوجود والوحدانية", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/dla2el_elwogod.mp3" },
            { name: "إبتلاء الصالحين", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/ebtla2_elsal7en.mp3" },
            { name: "فساد العباد و البلاد", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/fasad_al3bad_we_albelad.mp3" },
            { name: "وفي الصدق النجاة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/fe_alseq_alnagah.mp3" },
            { name: "فرسان السنة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/forsan_al3aqeda.mp3" },
            { name: "فتنة المال", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/ftnat_almal_1_3.mp3" },
            { name: "هؤلاء هم آبائنا", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/ha2wla2_hom_2aba2na.mp3" },
            { name: "جريمة العار", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/jarematul3ar.mp3" },
            { name: "كلمات حول أحداث غزة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/kalmat_na7o_3aza.mp3" },
            { name: "كشف الاستار وفضح الأسرار", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/kashf_al2star.mp3" },
            { name: "منزلة النبي فى القلوب", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/manzelt_elnabe_fe_elklob.mp3" },
            { name: "مات الرسول - صلى الله عليه وسلم - شهيد", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/mat_alrasol_shahed.mp3" },
            { name: "نعمة الأمن والأمان", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/na3met_elamn_we_alaman.mp3" },
            { name: "نتيجة فساد العباد", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/nategt_fasad_al3bad.mp3" },
            { name: "سفر الدنيا والآخرة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/safr_eldonya_we_al2khra.mp3" },
            { name: "سنة الابتلاءات", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/sont_alebtla2t.mp3" },
            { name: "تكريم الإنسان", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/takrem_al2nsan.mp3" },
            { name: "طوفان قوم نوح دروس وعبر", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/tofaan_no7.mp3" },
            { name: "ويـل للزناة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/wael_llzonah.mp3" },
            { name: "وصايا لقمان الحكيم", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/wasaya_lo2qman.mp3" },
            { name: "ويحك يا تارك الزكاة", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/way7k_ya_tark_alzakah.mp3" },
            { name: "وجاءت رياح الفتن", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/wga2t_rey7_alfatn.mp3" },
            { name: "ظهر الفساد فى البر والبحر", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/zahr_elfasad.mp3" },
            { name: "زكريا", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/zakreya.mp3" },
            { name: "ذل المعصية", url: "https://archive.org/download/Zoghbi.MawSSo3a.Part-1-Up-By-MusleM/zol_alm3sya.mp3" }
          ]
        }
      ]
    };

    // ===== مشغل الدروس =====
    const LessonPlayer = {
      audioPlayer: null,
      videoPlayer: null,
      nowPlaying: null,
      playingIndicator: null,
      bufferingLoader: null,
      sleepTimer: null,
      sleepTimerMinutes: 0,
      sleepTimerSeconds: 0,
      sleepTimerInterval: null,
      waitMode: false,
      currentLessonIndex: -1,
      currentContainerId: null,
      currentMediaUrl: "",
      isVideoMode: false,

      init() {
        this.audioPlayer = document.getElementById('audioPlayer');
        this.videoPlayer = document.getElementById('videoPlayer');
        this.nowPlaying = document.getElementById('currentLesson');
        this.playingIndicator = document.getElementById('playingIndicator');
        this.bufferingLoader = document.getElementById('bufferingLoader');
        this.renderLessons();
        this.setupEventListeners();
      },

      renderLessons() {
        const container = document.getElementById('stationsContainer');
        container.innerHTML = '';
        lessonsData.series.forEach(serie => {
          const serieElement = document.createElement('div');
          serieElement.className = 'lessons-container';
          serieElement.id = `lessonsContainer${serie.id}`;
          let optionsHTML = '<option value="">اختر درساً...</option>';
          serie.lessons.forEach(lesson => {
            optionsHTML += `<option value="${lesson.url}">${lesson.name}</option>`;
          });
          serieElement.innerHTML = `
            <img src="${serie.image}" alt="${serie.title}" class="station-image">
            <div class="lessons-title" style="color: ${serie.color}">${serie.title}</div>
            <select class="lessons-dropdown" id="lessonsDropdown${serie.id}">
              ${optionsHTML}
            </select>
            <div class="lesson-buttons">
              <button class="play-lesson-btn" onclick="LessonPlayer.playSelectedLesson(${serie.id})">
                <i class="fas fa-play"></i>
                تشغيل
              </button>
              <button class="play-lesson-btn stop-btn" onclick="LessonPlayer.stopLesson()">
                <i class="fas fa-stop"></i>
              </button>
            </div>
            <div class="progress-bar"></div>
          `;
          container.appendChild(serieElement);
        });
      },

      setupEventListeners() {
        // مستمعات الأحداث لمشغل الصوت
        this.audioPlayer.addEventListener('pause', () => {
          if (!this.isVideoMode) {
            this.playingIndicator.style.display = 'none';
          }
        });
        this.audioPlayer.addEventListener('play', () => {
          if (!this.isVideoMode) {
            this.playingIndicator.style.display = 'block';
          }
        });
        this.audioPlayer.addEventListener('ended', () => {
          if (!this.isVideoMode) {
            this.handleLessonEnd();
          }
        });

        // مستمعات الأحداث لمشغل الفيديو
        this.videoPlayer.addEventListener('pause', () => {
          if (this.isVideoMode) {
            this.playingIndicator.style.display = 'none';
          }
        });
        this.videoPlayer.addEventListener('play', () => {
          if (this.isVideoMode) {
            this.playingIndicator.style.display = 'block';
          }
        });
        this.videoPlayer.addEventListener('ended', () => {
          if (this.isVideoMode) {
            this.handleLessonEnd();
          }
        });

        // مستمعات الأحداث للقوائم المنسدلة
        document.querySelectorAll('.lessons-dropdown').forEach(dropdown => {
          dropdown.addEventListener('change', (e) => {
            const containerId = e.target.id.replace('lessonsDropdown', '');
            if (e.target.value) {
              this.playSelectedLesson(parseInt(containerId));
            }
          });
        });
      },

      playSelectedLesson(containerId) {
        const lessonsDropdown = document.getElementById(`lessonsDropdown${containerId}`);
        const lessonsContainer = document.getElementById(`lessonsContainer${containerId}`);
        const selectedOption = lessonsDropdown.options[lessonsDropdown.selectedIndex];
        const lessonUrl = selectedOption.value;
        const lessonName = selectedOption.text;
        
        if (!lessonUrl) {
          this.showMessage('الرجاء اختيار درس أولاً');
          return;
        }
        
        this.currentLessonIndex = lessonsDropdown.selectedIndex;
        this.currentContainerId = containerId;
        this.currentMediaUrl = lessonUrl;
        this.nowPlaying.textContent = `جاري تشغيل: ${lessonName}`;
        this.bufferingLoader.style.display = 'inline-block';
        this.playingIndicator.style.display = 'none';
        
        // إزالة الكلاس النشط من جميع الحاويات
        document.querySelectorAll('.lessons-container').forEach(container => {
          container.classList.remove('active');
        });
        lessonsContainer.classList.add('active');
        
        // إظهار أزرار التبديل بين الصوت والفيديو
        document.getElementById('mediaTypeToggle').style.display = 'flex';
        
        // تشغيل الوسائط حسب الوضع الحالي
        if (this.isVideoMode) {
          this.playVideo();
        } else {
          this.playAudio();
        }
      },

      playAudio() {
        this.isVideoMode = false;
        this.audioPlayer.style.display = 'block';
        this.videoPlayer.style.display = 'none';
        this.videoPlayer.pause();
        this.videoPlayer.src = '';
        
        this.audioPlayer.src = this.currentMediaUrl;
        this.audioPlayer.play().then(() => {
          this.bufferingLoader.style.display = 'none';
          this.playingIndicator.style.display = 'block';
        }).catch(error => {
          console.error('خطأ في تشغيل الصوت:', error);
          // إذا فشل تشغيل الصوت، حاول تشغيل الفيديو تلقائياً
          this.showMessage('لا يمكن تشغيل الصوت، سيتم التحويل إلى وضع الفيديو');
          setTimeout(() => {
            this.switchToVideo();
          }, 1000);
        });
      },

      playVideo() {
        this.isVideoMode = true;
        this.videoPlayer.style.display = 'block';
        this.audioPlayer.style.display = 'none';
        this.audioPlayer.pause();
        this.audioPlayer.src = '';
        
        this.videoPlayer.src = this.currentMediaUrl;
        this.videoPlayer.play().then(() => {
          this.bufferingLoader.style.display = 'none';
          this.playingIndicator.style.display = 'block';
        }).catch(error => {
          console.error('خطأ في تشغيل الفيديو:', error);
          this.nowPlaying.textContent = `خطأ في تشغيل الفيديو`;
          this.bufferingLoader.style.display = 'none';
          document.querySelectorAll('.lessons-container').forEach(container => {
            container.classList.remove('active');
          });
        });
      },

      stopLesson() {
        this.audioPlayer.pause();
        this.videoPlayer.pause();
        this.audioPlayer.src = "";
        this.videoPlayer.src = "";
        this.nowPlaying.textContent = 'اختر درساً للاستماع';
        this.playingIndicator.style.display = 'none';
        this.bufferingLoader.style.display = 'none';
        document.querySelectorAll('.lessons-container').forEach(container => {
          container.classList.remove('active');
        });
        document.querySelectorAll('.lessons-dropdown').forEach(dropdown => {
          dropdown.value = '';
        });
        document.getElementById('mediaTypeToggle').style.display = 'none';
        
        if (this.waitMode) {
          this.waitMode = false;
          document.getElementById('waitBtn').classList.remove('active');
        }
      },

      handleLessonEnd() {
        this.playingIndicator.style.display = 'none';
        if (this.waitMode && this.currentContainerId !== null) {
          const dropdown = document.getElementById(`lessonsDropdown${this.currentContainerId}`);
          if (this.currentLessonIndex < dropdown.options.length - 1) {
            this.currentLessonIndex++;
            dropdown.selectedIndex = this.currentLessonIndex;
            this.playSelectedLesson(this.currentContainerId);
            return;
          }
        }
        this.nowPlaying.textContent = 'انتهى الدرس';
        document.querySelectorAll('.lessons-container').forEach(container => {
          container.classList.remove('active');
        });
        if (this.waitMode) {
          this.waitMode = false;
          document.getElementById('waitBtn').classList.remove('active');
        }
      },

      toggleSleepTimer() {
        if (this.sleepTimerInterval) {
          this.cancelSleepTimer();
        } else {
          document.getElementById('sleepTimerModal').style.display = 'flex';
          this.setupTimerOptions();
        }
      },

      setupTimerOptions() {
        const timerOptions = document.querySelectorAll('.timer-option');
        timerOptions.forEach(option => {
          option.onclick = () => {
            timerOptions.forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
          };
        });
      },

      setSleepTimer() {
        const selectedOption = document.querySelector('.timer-option.selected');
        if (!selectedOption) {
          this.showMessage('الرجاء اختيار وقت للمؤقت');
          return;
        }
        const minutes = parseInt(selectedOption.dataset.minutes);
        if (this.sleepTimerInterval) clearInterval(this.sleepTimerInterval);
        this.sleepTimerMinutes = minutes;
        this.sleepTimerSeconds = 0;
        document.getElementById('sleepTimerBtn').classList.add('active');
        document.getElementById('timerStatus').style.display = 'block';
        this.updateTimerDisplay();
        this.sleepTimerInterval = setInterval(() => {
          this.sleepTimerSeconds--;
          if (this.sleepTimerSeconds < 0) {
            this.sleepTimerMinutes--;
            this.sleepTimerSeconds = 59;
          }
          this.updateTimerDisplay();
          if (this.sleepTimerMinutes <= 0 && this.sleepTimerSeconds <= 0) {
            this.stopLesson();
            this.nowPlaying.textContent = 'تم إيقاف التشغيل حسب مؤقت النوم';
            this.cancelSleepTimer();
          }
        }, 1000);
        this.closeSleepTimerModal();
      },

      cancelSleepTimer() {
        if (this.sleepTimerInterval) {
          clearInterval(this.sleepTimerInterval);
          this.sleepTimerInterval = null;
        }
        document.getElementById('sleepTimerBtn').classList.remove('active');
        document.getElementById('timerStatus').style.display = 'none';
      },

      updateTimerDisplay() {
        const minutes = this.sleepTimerMinutes.toString().padStart(2, '0');
        const seconds = this.sleepTimerSeconds.toString().padStart(2, '0');
        document.getElementById('timerCountdown').textContent = `${minutes}:${seconds}`;
      },

      closeSleepTimerModal() {
        document.getElementById('sleepTimerModal').style.display = 'none';
      },

      toggleWait() {
        if (this.waitMode) {
          this.waitMode = false;
          document.getElementById('waitBtn').classList.remove('active');
          this.nowPlaying.textContent = this.nowPlaying.textContent.replace(' (وضع الانتظار مفعل)', '');
        } else {
          if (this.currentLessonIndex === -1) {
            this.showMessage('الرجاء تشغيل درس أولاً');
            return;
          }
          document.getElementById('waitModal').style.display = 'flex';
        }
      },

      enableWaitMode() {
        this.waitMode = true;
        document.getElementById('waitBtn').classList.add('active');
        this.nowPlaying.textContent += ' (وضع الانتظار مفعل)';
        this.closeWaitModal();
      },

      closeWaitModal() {
        document.getElementById('waitModal').style.display = 'none';
      },

      showMessage(message) {
        alert(message);
      }
    };

    // ===== دوال التبديل بين الصوت والفيديو =====
    function switchToAudio() {
      LessonPlayer.isVideoMode = false;
      document.getElementById('audioBtn').classList.add('active');
      document.getElementById('videoBtn').classList.remove('active');
      if (LessonPlayer.currentMediaUrl) {
        LessonPlayer.playAudio();
      }
    }

    function switchToVideo() {
      LessonPlayer.isVideoMode = true;
      document.getElementById('videoBtn').classList.add('active');
      document.getElementById('audioBtn').classList.remove('active');
      if (LessonPlayer.currentMediaUrl) {
        LessonPlayer.playVideo();
      }
    }

    // ===== دوال عامة =====
    function goBack() {
      window.location.href = 'index.html';
    }

    function shareApp() {
      const shareData = {
        title: 'دروس الشيخ محمد عبد الملك الزغبي',
        text: 'استمع إلى دروس الشيخ محمد عبد الملك الزغبي - صفحة اللهم لك الحمد',
        url: window.location.href
      };
      if (navigator.share) {
        navigator.share(shareData).catch(console.error);
      } else {
        navigator.clipboard.writeText(`${shareData.title}\n${shareData.text}\n${shareData.url}`).then(() => {
          alert('تم نسخ الرابط إلى الحافظة!');
        }).catch(() => {
          alert('فشل النسخ، يرجى نسخ الرابط يدوياً');
        });
      }
    }

    function reportBrokenLink() {
      const phoneNumber = '+201092116092';
      const message = 'يوجد رابط معطل في دروس الشيخ محمد عبد الملك الزغبي، يرجى التحقق';
      const whatsappUrl = `https://wa.me/${phoneNumber.replace('+', '')}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }

    // ===== دوال واجهة المستخدم =====
    function toggleSleepTimer() { LessonPlayer.toggleSleepTimer(); }
    function setSleepTimer() { LessonPlayer.setSleepTimer(); }
    function closeSleepTimerModal() { LessonPlayer.closeSleepTimerModal(); }
    function toggleWait() { LessonPlayer.toggleWait(); }
    function enableWaitMode() { LessonPlayer.enableWaitMode(); }
    function closeWaitModal() { LessonPlayer.closeWaitModal(); }

    // ===== تهيئة التطبيق =====
    document.addEventListener('DOMContentLoaded', () => {
      LessonPlayer.init();
    });
  </script>
</body>
</html>
